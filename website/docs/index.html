<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Bo Jacobs Strom">
<meta name="dcterms.date" content="2024-05-01">

<title>website - Replication: Urban Public Works in Spatial Equilibrium</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">website</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./index.html" rel="" target="" aria-current="page">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#t2-treatment-effects-on-labour-outcomes" id="toc-t2-treatment-effects-on-labour-outcomes" class="nav-link active" data-scroll-target="#t2-treatment-effects-on-labour-outcomes">T2 Treatment Effects on Labour Outcomes</a></li>
  <li><a href="#wage-effects" id="toc-wage-effects" class="nav-link" data-scroll-target="#wage-effects">Wage Effects</a>
  <ul class="collapse">
  <li><a href="#f3" id="toc-f3" class="nav-link" data-scroll-target="#f3">F3</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Replication: Urban Public Works in Spatial Equilibrium</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Bo Jacobs Strom </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">May 1, 2024</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<p>This document contains my replication of the main results of <em>Urban Public Works in Spatial Equilibrium (2023)</em> by <em>Franklin, Imbert, Abebe, and Mejia-Mantilla</em>. The paper analyses the results of a randomised control trial which randomly assigned poorer areas of Addis Ababa, Ethiopia, to public works projects aimed at neighbourhood improvement. I replicated five of the paper’s main results (tables 2, 3, 4, and 6 as well as figure 2) in Julia, as well as table 5, which I replicated using Julia’s <code>RCall</code> package for reasons which I expand on below. The code takes significantly longer to run than the original R version, which is surprising given Julia is generally faster than R - the slow down seems to be mostly due to the many regressions necessary to calculate the RI p-values for table three, for these I have tried several different solutions, including both multithreading the loop which runs them (though the <code>FixedEffectsModlels.jl</code> package already should multithread each regression), as well as the <code>@fastmath</code> macro - however while multithreading brings a slight performance increase, the speed remains very slow.</p>
<section id="t2-treatment-effects-on-labour-outcomes" class="level2">
<h2 class="anchored" data-anchor-id="t2-treatment-effects-on-labour-outcomes">T2 Treatment Effects on Labour Outcomes</h2>
<p>I first replicate the results on the direct effects of the public works program on employment and amenities using the specification: <span class="math display">\[
Y_{whi} = \alpha Y_{whi}^0 + \beta T_i + \delta X_{whi} + \varepsilon_{whi}
\]</span></p>
<p>Where <span class="math inline">\(Y_{whi}^0\)</span> is a worker’s outcome at baseline, and <span class="math inline">\(X_{whi}\)</span> is a set of worker controls at baseline. This is a direct intention-to-treat estimate, as within each area <span class="math inline">\(i\)</span> there are both eligible and non-eligible workers <span class="math inline">\(w\)</span>. The identification assumption is that the randomisation was succesful. Results are identical for the employment specifications, and only slightly different for the Neighbourhood Amenities column. These small differences may be due to differences in the controls used - here, as in the replication package, I only use subcity fixed effects in the neighborhood amenities column, whereas in the paper it is mentioned that individual controls are also used. I also tried replicating the specification where additional controls are selected using a GLMNet process, but for me this selected a different set of controls than in the R replication package.</p>

<table>
<style>
table {
    border-collapse: collapse;
    border: none;
    border-top: double;
    border-bottom: double;
}
th, td {
    padding: 0.2em;
    padding-left: 0.8em;
    padding-right: 0.8em;
}
</style>
<tbody>
<tr>
<td style="padding:0.1cm" colspan="100%">
</td>
</tr>
<tr>
<td>
</td>
<td colspan="1" style="padding:0.2cm; text-align:center; border-bottom:1px solid;">
Employment
</td>
<td colspan="1" style="padding:0.2cm; text-align:center; border-bottom:1px solid;">
Public Employment
</td>
<td colspan="1" style="padding:0.2cm; text-align:center; border-bottom:1px solid;">
Private Employment
</td>
<td colspan="1" style="padding:0.2cm; text-align:center; border-bottom:1px solid;">
Neighbourhood Amenities
</td>
</tr>
<tr>
<td>
</td>
<td>
(1)
</td>
<td>
(2)
</td>
<td>
(3)
</td>
<td>
(4)
</td>
</tr>
<tr style="border-bottom:1px solid">
<td style="padding:0.1cm" colspan="100%">
</td>
</tr>
<tr>
<td style="padding:0.1cm" colspan="100%">
</td>
</tr>
<tr>
<td>
Treatment
</td>
<td>
-0.001
</td>
<td>
0.046***
</td>
<td>
-0.047***
</td>
<td>
0.570***
</td>
</tr>
<tr>
<td>
</td>
<td>
(0.012)
</td>
<td>
(0.002)
</td>
<td>
(0.012)
</td>
<td>
(0.077)
</td>
</tr>
<tr style="border-bottom:1px solid">
<td style="padding:0.1cm" colspan="100%">
</td>
</tr>
<tr>
<td style="padding:0.1cm" colspan="100%">
</td>
</tr>
<tr>
<td>
Subcity Fixed Effects
</td>
<td>
Yes
</td>
<td>
Yes
</td>
<td>
Yes
</td>
<td>
Yes
</td>
</tr>
<tr style="border-bottom:1px solid">
<td style="padding:0.1cm" colspan="100%">
</td>
</tr>
<tr>
<td style="padding:0.1cm" colspan="100%">
</td>
</tr>
<tr>
<td>
Controls
</td>
<td>
Yes
</td>
<td>
Yes
</td>
<td>
Yes
</td>
<td>
</td>
</tr>
<tr style="border-bottom:1px solid">
<td style="padding:0.1cm" colspan="100%">
</td>
</tr>
<tr>
<td style="padding:0.1cm" colspan="100%">
</td>
</tr>
<tr>
<td>
Observations
</td>
<td>
19,442
</td>
<td>
19,442
</td>
<td>
19,442
</td>
<td>
5,712
</td>
</tr>
<tr>
<td>
Control Mean
</td>
<td>
0.366
</td>
<td>
0.0
</td>
<td>
0.366
</td>
<td>
0.0
</td>
</tr>
<tr>
<td style="padding:0.15cm" colspan="100%">
</td>
</tr>
</tbody>

</table>
<table>
<style>
table {
    border-collapse: collapse;
    border: none;
    border-top: double;
    border-bottom: double;
}
th, td {
    padding: 0.2em;
    padding-left: 0.8em;
    padding-right: 0.8em;
}
</style>
<tbody>
<tr>
<td style="padding:0.1cm" colspan="100%">
</td>
</tr>
<tr>
<td>
</td>
<td colspan="1" style="padding:0.2cm; text-align:center; border-bottom:1px solid;">
Employment
</td>
<td colspan="1" style="padding:0.2cm; text-align:center; border-bottom:1px solid;">
Public Employment
</td>
<td colspan="1" style="padding:0.2cm; text-align:center; border-bottom:1px solid;">
Private Employment
</td>
<td colspan="1" style="padding:0.2cm; text-align:center; border-bottom:1px solid;">
Neighbourhood Amenities
</td>
</tr>
<tr>
<td>
</td>
<td>
(1)
</td>
<td>
(2)
</td>
<td>
(3)
</td>
<td>
(4)
</td>
</tr>
<tr style="border-bottom:1px solid">
<td style="padding:0.1cm" colspan="100%">
</td>
</tr>
<tr>
<td style="padding:0.1cm" colspan="100%">
</td>
</tr>
<tr>
<td>
Treatment
</td>
<td>
0.021
</td>
<td>
0.101***
</td>
<td>
-0.080***
</td>
<td>
0.603***
</td>
</tr>
<tr>
<td>
</td>
<td>
(0.015)
</td>
<td>
(0.003)
</td>
<td>
(0.014)
</td>
<td>
(0.083)
</td>
</tr>
<tr style="border-bottom:1px solid">
<td style="padding:0.1cm" colspan="100%">
</td>
</tr>
<tr>
<td style="padding:0.1cm" colspan="100%">
</td>
</tr>
<tr>
<td>
Subcity Fixed Effects
</td>
<td>
Yes
</td>
<td>
Yes
</td>
<td>
Yes
</td>
<td>
Yes
</td>
</tr>
<tr style="border-bottom:1px solid">
<td style="padding:0.1cm" colspan="100%">
</td>
</tr>
<tr>
<td style="padding:0.1cm" colspan="100%">
</td>
</tr>
<tr>
<td>
Controls
</td>
<td>
Yes
</td>
<td>
Yes
</td>
<td>
Yes
</td>
<td>
</td>
</tr>
<tr style="border-bottom:1px solid">
<td style="padding:0.1cm" colspan="100%">
</td>
</tr>
<tr>
<td style="padding:0.1cm" colspan="100%">
</td>
</tr>
<tr>
<td>
Observations
</td>
<td>
8,679
</td>
<td>
8,679
</td>
<td>
8,679
</td>
<td>
2,409
</td>
</tr>
<tr>
<td>
Control Mean
</td>
<td>
0.36
</td>
<td>
0.0
</td>
<td>
0.359
</td>
<td>
-0.007
</td>
</tr>
<tr>
<td style="padding:0.15cm" colspan="100%">
</td>
</tr>
</tbody>

</table>
<table>
<style>
table {
    border-collapse: collapse;
    border: none;
    border-top: double;
    border-bottom: double;
}
th, td {
    padding: 0.2em;
    padding-left: 0.8em;
    padding-right: 0.8em;
}
</style>
<tbody>
<tr>
<td style="padding:0.1cm" colspan="100%">
</td>
</tr>
<tr>
<td>
</td>
<td colspan="1" style="padding:0.2cm; text-align:center; border-bottom:1px solid;">
Employment
</td>
<td colspan="1" style="padding:0.2cm; text-align:center; border-bottom:1px solid;">
Public Employment
</td>
<td colspan="1" style="padding:0.2cm; text-align:center; border-bottom:1px solid;">
Private Employment
</td>
<td colspan="1" style="padding:0.2cm; text-align:center; border-bottom:1px solid;">
Neighbourhood Amenities
</td>
</tr>
<tr>
<td>
</td>
<td>
(1)
</td>
<td>
(2)
</td>
<td>
(3)
</td>
<td>
(4)
</td>
</tr>
<tr style="border-bottom:1px solid">
<td style="padding:0.1cm" colspan="100%">
</td>
</tr>
<tr>
<td style="padding:0.1cm" colspan="100%">
</td>
</tr>
<tr>
<td>
Treatment
</td>
<td>
-0.001
</td>
<td>
0.046***
</td>
<td>
-0.047***
</td>
<td>
0.570***
</td>
</tr>
<tr>
<td>
</td>
<td>
(0.012)
</td>
<td>
(0.002)
</td>
<td>
(0.012)
</td>
<td>
(0.077)
</td>
</tr>
<tr style="border-bottom:1px solid">
<td style="padding:0.1cm" colspan="100%">
</td>
</tr>
<tr>
<td style="padding:0.1cm" colspan="100%">
</td>
</tr>
<tr>
<td>
Subcity Fixed Effects
</td>
<td>
Yes
</td>
<td>
Yes
</td>
<td>
Yes
</td>
<td>
Yes
</td>
</tr>
<tr style="border-bottom:1px solid">
<td style="padding:0.1cm" colspan="100%">
</td>
</tr>
<tr>
<td style="padding:0.1cm" colspan="100%">
</td>
</tr>
<tr>
<td>
Controls
</td>
<td>
Yes
</td>
<td>
Yes
</td>
<td>
Yes
</td>
<td>
</td>
</tr>
<tr style="border-bottom:1px solid">
<td style="padding:0.1cm" colspan="100%">
</td>
</tr>
<tr>
<td style="padding:0.1cm" colspan="100%">
</td>
</tr>
<tr>
<td>
Observations
</td>
<td>
19,442
</td>
<td>
19,442
</td>
<td>
19,442
</td>
<td>
5,712
</td>
</tr>
<tr>
<td>
Control Mean
</td>
<td>
0.366
</td>
<td>
0.0
</td>
<td>
0.366
</td>
<td>
0.0
</td>
</tr>
<tr>
<td style="padding:0.15cm" colspan="100%">
</td>
</tr>
</tbody>

</table>
</section>
<section id="wage-effects" class="level2">
<h2 class="anchored" data-anchor-id="wage-effects">Wage Effects</h2>
<p>I now replicate the paper’s results on the effects of the public works program on wages. For this purposes the naive specification above is unlikely to be appropriate as there are likely spillover’s between treated and non-treated areas due to commuting patterns - this means the Stable Unit Treatment Value Assumption (SUTVA) is unlikely to hold. The authors construct a spatial equilibrium model which emphasises that due to commuting, the effects of the program are likely captured in changes by wage changes at the place of work rather than the place of residence. By ignoring endogenous changes to commuting patterns the authors can then take the model to the data by constructing an <em>exposure</em> variable: <span class="math display">\[
Exposure_j = \sum_i \lambda_{ij} T_i - \frac{1}{R} \sum_{0 \leq r \leq R} \sum_i \lambda_{ij} \tilde{T_i^r}
\]</span></p>
<p>Where <span class="math inline">\(T_i\)</span> is a dummy for the implementation of the program in neighborhood of residence <span class="math inline">\(i\)</span> and <span class="math inline">\(\lambda_{ij}\)</span> is the probability at baseline that a worker who works in neighbourhood <span class="math inline">\(j\)</span> lives in neighbourhood <span class="math inline">\(i\)</span>. The second term is a recentering of actual exposure using average potential exposure from 2000 simulated independent treatment asignments which follow the same random allocation, which avoids omitted variable bias. This is similar to a shift-share instrument, with <span class="math inline">\(\lambda_{ij}\)</span> the endogenous share, and <span class="math inline">\(T_i\)</span> the exogenous shift. On the assumption that the the randomisation of treatment was succesful, <span class="math inline">\(\beta\)</span> in the following equation then captures the causal effect of program exposure on wages: <span class="math display">\[
\ln w_j = \alpha + \beta Exposure_j + \gamma \ln w_j^0 + \delta X_j + \varepsilon_j
\]</span></p>
<section id="f3" class="level3">
<h3 class="anchored" data-anchor-id="f3">F3</h3>
<p>I now succesfully replicate figure three. Figure three is a scatter plot of average log wages in an area on the exposure variable above, separated into those areas which were actually treated and those that were not, showing a similar positive association between exposure and wages, with little discontinuity between the two groups.</p>
<p><img src="fig3.png" class="img-fluid" alt="Figure 3"> This is a Quarto website.</p>
<p>To learn more about Quarto websites visit <a href="https://quarto.org/docs/websites" class="uri">https://quarto.org/docs/websites</a>.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>